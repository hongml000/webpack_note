 # 代码分割
 代码分割是将一个模块分为多个语块的一种处理方式。

 ## 什么场景下需要使用代码分割？  
 * 当一个模块过大时，加载时间过长，例如：
  ```js
  import _ from 'lodash'   // 假设加载这模块要1Mb

  // ... 此处省略n行业务代码 假设有1Mb
  console.log(_.join(['a','b','c'],' '))
  ```
  这种情况下打包的话，每次都要加载2Mb内容的大小；每当业务代码改任何一处小地方时，都要再重新加载2Mb内容，导致首次加载时间都很长。  


## 那么又如何在webpack中实现代码分割呢？  
### 人为分文件  
```json
// project/package.json
{
  "scripts": {
    "dev-build": "webpack --config webpack.dev.js"
  }
}
```
```js
// project/src/loadash_im.js
import _ from 'lodash'
window._ = _

// project/src/index.js
// ... 此处省略n行业务代码 假设有1Mb
console.log(_.join(['a','b','c'],' '))

// webpack.common.js
module.exports = {
  // 入口文件这里要注意先后顺序
  entry: {
    loadash_im: './src/loadash_im.js',
    main: './src/index.js'
  },
  output: {
    filename: '[name].js',
    path: path.resolve(__dirname,'dist')
  }
}
```
运行```npm run dev-build```后，针对更改的业务逻辑只会重新打包1mb的内容，但效率在初次打包可能也没有太大的优化

### 使用webpack配置项optimization
```js
// project/webpack.common.js
module.exports = {
  entry: {
    main: './src/index.js'
  },
  output: {
    filename: '[name].js',
    path: path.resolve(__dirname,'dist')
  },
  optimization:{
    splitChunks: {
      chunks: 'all'
    }
  }
}

// index.js 
import _ from 'lodash'
console.log(_.join(['a','b','c'],' '))
```

### 按需加载